---
title: "wk5_prac"
author: "chris"
date: "2021/11/15"
output: html_document
---
```{r}

```

# Notes

bedroom is at ward - convert to borough
could also probably just use Local Area District Data
Hotel is points - summarise over borough
Airbnb is points - summarise over borough


```{r library}
library(sf)
library(tidyverse)
library(janitor)
library(tmap)
library(tmaptools)
library(here)
```

```{r wards etc}
Londonboroughs <- st_read(here::here('data',
                               'statistical-gis-boundaries-london',
                               'ESRI',
                               'London_Borough_Excluding_MHW.shp'))%>%
  clean_names()%>%
  st_transform(.,27700)


Londonwards <- st_read(here::here('data',
                               'statistical-gis-boundaries-london',
                               'ESRI',
                               'London_ward.shp'))%>%
  clean_names()%>%
  st_transform(.,27700)
```
```{r accomodation data}
OSM <- st_read(here::here('data',
                          'greater-london-latest-free.shp',
                          'gis_osm_pois_a_free_1.shp'))%>%
  st_transform(.,27700)           #crs转换为british national grid 27700

Airbnb <- read_csv(here::here('data',
                              'listings',
                              'listings.csv'))%>%
  st_as_sf(.,coords=c('longitude','latitude'),
           crs=4326)%>%
  st_transform(.,27700)

Worldcities <- st_read(here::here('data',
                                  'World_Cities',
                                  'World_Cities.shp'))

ward_beds <- read_csv(here::here('data',
                              'ward_bedrooms.csv'))%>%
  clean_names()
```
```{r bed to borough}
bed_borough <- Londonwards %>%
    merge(.,
       ward_beds, 
        by.x="gss_code", 
        by.y="geography_code")%>%
  clean_names()%>%
  group_by(lb_gss_cd,borough)%>%
  summarise(total_beds_per_borough=sum(bedrooms_all_categories_number_of_bedrooms_measures_value,na.rm=TRUE))
            
```
```{r}
Airbnb_borough <- Airbnb%>%
  filter(room_type=='Entire home/apt')%>%
  filter(availability_365=='365')%>%
  st_join(Londonboroughs,.)%>%
  group_by(gss_code)%>%
  summarise()
  
```

